---
import type { GuideCategory } from "../../data/guideData";

interface Props {
    categories: GuideCategory[];
    currentSection?: string;
}

const { categories, currentSection } = Astro.props;
---

<aside class="guide-sidebar">
    <div class="sidebar-content">
        <div class="sidebar-header">
            <a href="/wsf-landing/" class="back-link">
                <svg
                    class="w-5 h-5"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                <span>Volver al inicio</span>
            </a>
            <h2 class="sidebar-title">Gu√≠a de Uso</h2>
        </div>

        <nav class="sidebar-nav">
            {
                categories.map((category) => (
                    <div class="category-section">
                        <h3 class="category-title">{category.title}</h3>
                        <ul class="section-list">
                            {category.sections.map((section) => (
                                <li>
                                    <a
                                        href={`#${section.id}`}
                                        class={`section-link ${currentSection === section.id ? "active" : ""}`}
                                        data-section={section.id}
                                    >
                                        {section.title}
                                    </a>
                                    {section.subsections &&
                                        section.subsections.length > 0 && (
                                            <ul class="subsection-list">
                                                {section.subsections.map(
                                                    (subsection) => (
                                                        <li>
                                                            <a
                                                                href={`#${subsection.id}`}
                                                                class="subsection-link"
                                                                data-section={
                                                                    subsection.id
                                                                }
                                                            >
                                                                {
                                                                    subsection.title
                                                                }
                                                            </a>
                                                        </li>
                                                    ),
                                                )}
                                            </ul>
                                        )}
                                </li>
                            ))}
                        </ul>
                    </div>
                ))
            }
        </nav>
    </div>
</aside>

<style>
    .guide-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 260px;
        height: 100vh;
        border-right: 1px solid rgba(148, 163, 184, 0.1);
        background: rgba(15, 23, 42, 0.4);
        backdrop-filter: blur(10px);
        display: flex;
        flex-direction: column;
    }

    .sidebar-content {
        flex: 1;
        overflow-y: auto;
        padding: 2rem 1.5rem;
    }

    .sidebar-header {
        margin-bottom: 2rem;
    }

    .back-link {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #94a3b8;
        text-decoration: none;
        font-size: 0.875rem;
        margin-bottom: 1.5rem;
        transition: color 0.2s;
    }

    .back-link:hover {
        color: #7877c6;
    }

    .sidebar-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: white;
        margin: 0;
    }

    .category-section {
        margin-bottom: 2rem;
    }

    .category-title {
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: #94a3b8;
        margin-bottom: 0.75rem;
    }

    .section-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .section-list > li {
        margin-bottom: 0.25rem;
    }

    .section-link {
        display: block;
        padding: 0.5rem 0.75rem;
        color: #cbd5e1;
        text-decoration: none;
        border-radius: 0.375rem;
        font-size: 0.875rem;
        transition: all 0.2s;
        border-left: 2px solid transparent;
    }

    .section-link:hover {
        color: white;
        background: rgba(120, 119, 198, 0.1);
    }

    .section-link.active {
        color: #7877c6;
        background: rgba(120, 119, 198, 0.15);
        border-left-color: #7877c6;
        font-weight: 500;
    }

    .subsection-list {
        list-style: none;
        padding-left: 1.25rem;
        margin: 0.25rem 0;
    }

    .subsection-link {
        display: block;
        padding: 0.375rem 0.75rem;
        color: #94a3b8;
        text-decoration: none;
        border-radius: 0.375rem;
        font-size: 0.8125rem;
        transition: all 0.2s;
    }

    .subsection-link:hover {
        color: #cbd5e1;
        background: rgba(120, 119, 198, 0.08);
    }

    /* Scrollbar styling */
    .guide-sidebar::-webkit-scrollbar {
        width: 6px;
    }

    .guide-sidebar::-webkit-scrollbar-track {
        background: transparent;
    }

    .guide-sidebar::-webkit-scrollbar-thumb {
        background: rgba(148, 163, 184, 0.3);
        border-radius: 3px;
    }

    .guide-sidebar::-webkit-scrollbar-thumb:hover {
        background: rgba(148, 163, 184, 0.5);
    }

    @media (max-width: 1024px) {
        .guide-sidebar {
            display: none;
        }
    }
</style>

<script>
    // Smooth scroll to exact top position when clicking sidebar links
    document
        .querySelectorAll(".section-link, .subsection-link")
        .forEach((link) => {
            link.addEventListener("click", (e) => {
                e.preventDefault();
                const targetId = link.getAttribute("href")?.substring(1);
                if (targetId) {
                    const targetElement = document.getElementById(targetId);
                    if (targetElement) {
                        const offsetTop = targetElement.offsetTop;
                        window.scrollTo({
                            top: offsetTop - 20,
                            behavior: "smooth",
                        });
                    }
                }
            });
        });

    // Highlight active section on scroll
    const observer = new IntersectionObserver(
        (entries) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    const id = entry.target.id;
                    document
                        .querySelectorAll(".section-link")
                        .forEach((link) => {
                            link.classList.remove("active");
                        });
                    const activeLink = document.querySelector(
                        `.section-link[data-section="${id}"]`,
                    );
                    if (activeLink) {
                        activeLink.classList.add("active");
                    }
                }
            });
        },
        {
            rootMargin: "-100px 0px -66%",
        },
    );

    document.querySelectorAll("section[id]").forEach((section) => {
        observer.observe(section);
    });
</script>
